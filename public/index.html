<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>uyu.exchange – Comparando pizarras</title>
    <meta name="description" content="Comparador de cotizaciones USD/UYU en tiempo real. Calculadora rápida y acceso a la API para developers." />

    <!-- Open Graph / SEO - Revisar -->
    <meta property="og:title" content="uyu.exchange – Comparando pizarras" />
    <meta property="og:description" content="La web donde los uruguayos miran el dólar. Comparador, calculadora y API." />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="es_UY" />
    <meta property="og:url" content="https://uyu.exchange/" />
    <meta property="og:image" content="/og-image.png" />

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
        theme: {
        extend: {
            colors: {
            // Verde "dólar" en paleta: sobrio, legible, accesible
            brand: {
                50:  '#f1f8f5',
                100: '#dcefe6',
                200: '#c1e1d1',
                300: '#99ccb3',
                400: '#6fb896',
                500: '#4aa87d',  /* primario */
                600: '#2f9467',  /* hover/activo */
                700: '#247a56',
                800: '#1f6247',
                900: '#1a523c'
            }
            }
        }
        }
    }
    </script>

    <link rel="icon" href="/favicon.ico" />
  </head>
  <body class="bg-gradient-to-b from-white to-brand-50 text-slate-900 antialiased">
    <!-- Header -->
    <header class="sticky top-0 z-40 backdrop-blur bg-white/70 border-b border-slate-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <a href="/" class="flex items-center gap-2 font-semibold text-slate-900">
            <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-brand-600 text-white">U</span>
            <span class="hidden sm:inline">uyu.exchange</span>
          </a>
          <nav class="hidden md:flex items-center gap-6 text-sm">
            <a href="/" class="hover:text-brand-700">Inicio</a>
            <!-- <a href="/calculadora" class="hover:text-brand-700">Calculadora</a> -->
            <a href="/nosotros.html" class="hover:text-brand-700">Nosotros</a>
            <a href="/developers.html" class="inline-flex items-center rounded-xl bg-brand-600 px-4 py-2 font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-600">Desarrolladores</a>
          </nav>
          <button id="menuBtn" class="md:hidden inline-flex items-center justify-center rounded-lg p-2 hover:bg-slate-100" aria-label="Abrir menú">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M3.75 5.25a.75.75 0 0 1 .75-.75h15a.75.75 0 0 1 0 1.5h-15a.75.75 0 0 1-.75-.75Zm0 6a.75.75 0 0 1 .75-.75h15a.75.75 0 0 1 0 1.5h-15a.75.75 0 0 1-.75-.75Zm0 6a.75.75 0 0 1 .75-.75h15a.75.75 0 0 1 0 1.5h-15a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"/></svg>
          </button>
        </div>
      </div>
      <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200 bg-white">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col gap-3 text-sm">
          <a href="/" class="hover:text-brand-700">Inicio</a>
          <!-- <a href="/calculadora" class="hover:text-brand-700">Calculadora</a> -->
          <a href="/nosotros.html" class="hover:text-brand-700">Nosotros</a>
          <a href="/developers.html" class="inline-flex items-center rounded-xl bg-brand-600 px-4 py-2 font-medium text-white w-max hover:bg-brand-700">Desarrolladores</a>
        </div>
      </div>
    </header>

    <!-- Hero -->
    <section class="relative">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-20">
        <div class="grid lg:grid-cols-2 gap-10 items-center">
          <div>
            <h1 class="text-3xl sm:text-5xl font-extrabold tracking-tight text-slate-900">
              Comparando pizarras
            </h1>
            <p class="mt-4 text-lg text-slate-600 max-w-prose">
              Compará compra y venta en bancos y casas de cambio de Uruguay. Calculá rápido en un solo lugar.
            </p>
            <div class="mt-6 flex flex-wrap gap-3">
              <a href="#live" class="inline-flex items-center rounded-xl bg-brand-600 px-5 py-3 text-white font-semibold hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-600">
                Ver cotizaciones ahora
              </a>
              <a href="https://developer.uyu.exchange" class="inline-flex items-center rounded-xl px-5 py-3 font-semibold text-brand-700 bg-brand-50 hover:bg-brand-100">
                ¿Sos developer? API →
              </a>
            </div>
            <p class="mt-3 text-xs text-slate-500">
              Datos actualizados. Hecho en Uruguay 🇺🇾.
            </p>
          </div>
          <div class="relative">
            <div class="rounded-2xl bg-white shadow-xl ring-1 ring-slate-200 p-4 sm:p-6">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-sm font-semibold text-slate-700">Mejores del momento</h3>
                  <p class="text-xs text-slate-500">Banco y casa de cambio destacados</p>
                </div>
                <span id="lastUpdated" class="text-xs text-slate-500">—</span>
              </div>
              <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3" id="cardsContainer">
                <!-- 2 tarjetas: mejor banco y mejor casa de cambio -->
              </div>
              <div class="mt-4 text-right">
                <a href="#live" class="text-sm font-medium text-brand-700 hover:underline">Ver todas las fuentes</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Live quotes -->
    <section id="live" class="py-12 sm:py-16 border-t border-slate-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-end justify-between gap-4">
          <div>
            <h2 class="text-2xl sm:text-3xl font-bold">Cotizaciones en vivo</h2>
            <p class="text-slate-600 text-sm">Separadas por tipo: Bancos y Casas de cambio.</p>
          </div>
          <!-- <a href="/calculadora" class="text-sm font-medium text-brand-700 hover:underline">Ir a calculadora avanzada</a> -->
        </div>

        <!-- Bancos -->
        <div class="mt-8">
          <div class="flex items-center justify-between">
            <h3 class="text-lg sm:text-xl font-semibold">Bancos</h3>
            <div class="text-xs text-slate-500" id="banksMeta"></div>
          </div>
          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="gridBanks"></div>
        </div>

        <!-- Casas de cambio -->
        <div class="mt-10">
          <div class="flex items-center justify-between">
            <h3 class="text-lg sm:text-xl font-semibold">Casas de cambio</h3>
            <div class="text-xs text-slate-500" id="exchangesMeta"></div>
          </div>
          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="gridExchanges"></div>
        </div>
      </div>
    </section>

    <!-- Calculadora -->
    <section class="py-12 sm:py-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div>
          <h2 class="text-2xl sm:text-3xl font-bold">Calculadora rápida</h2>
          <p class="mt-2 text-slate-600">Ingresá un monto y elegí la fuente para ver cuánto recibís en pesos.</p>
          <form id="calcForm" class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-2xl">
            <div>
              <label class="block text-sm font-medium text-slate-700">Monto en USD</label>
              <input id="usdAmount" type="number" min="0" step="0.01" value="100" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-600 focus:ring-brand-600" />
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700">Fuente</label>
              <select id="sourceSelect" class="mt-1 w-full rounded-xl border-slate-300 focus:border-brand-600 focus:ring-brand-600"></select>
            </div>
            <div class="sm:col-span-2">
              <button type="submit" class="inline-flex items-center rounded-xl bg-brand-600 px-5 py-3 text-white font-semibold hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-600">Calcular</button>
            </div>
            <div class="sm:col-span-2">
              <div id="calcResult" class="text-lg font-semibold"></div>
              <p id="calcHint" class="text-xs text-slate-500"></p>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Diferenciador -->
    <section class="py-12 sm:py-16 bg-white border-t border-slate-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid sm:grid-cols-3 gap-6">
          <div class="rounded-2xl p-6 ring-1 ring-slate-200 bg-slate-50">
            <div class="text-sm font-semibold">📊 Comparación en un solo lugar</div>
            <p class="mt-2 text-sm text-slate-600">Bancos y Casas de Cambio de Uruguay, lado a lado.</p>
          </div>
          <div class="rounded-2xl p-6 ring-1 ring-slate-200 bg-slate-50">
            <div class="text-sm font-semibold">⚡ Datos en tiempo real</div>
            <p class="mt-2 text-sm text-slate-600">Actualizaciones instantaneas con fuentes verificadas.</p>
          </div>
          <div class="rounded-2xl p-6 ring-1 ring-slate-200 bg-slate-50">
            <div class="text-sm font-semibold">🇺🇾 Hecho en Uruguay</div>
            <p class="mt-2 text-sm text-slate-600">Construido para la realidad local. Simple y confiable.</p>
          </div>
        </div>
        <div class="mt-10 text-center">
          <a href="/developers.html" class="inline-flex items-center rounded-xl bg-brand-600 px-6 py-3 text-white font-semibold hover:bg-brand-700">¿Desarrollador? Usá la API →</a>
        </div>
      </div>
    </section>

    <!-- Footer franja inferior -->
    <div class="border-t mx-auto border-slate-200 bg-brand-50/40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 text-xs sm:text-sm text-slate-600 flex flex-col sm:flex-row items-center justify-between gap-2">
        <div>© <span id="year"></span> uyu.exchange — Hecho en Uruguay 🇺🇾</div>
        <div class="flex items-center gap-4">
            <a href="/" class="hover:text-brand-700">Inicio</a>
            <a href="/nosotros.html" class="hover:text-brand-700">Nosotros</a>
            <a href="/developers.html" class="hover:text-brand-700">Desarrolladores</a>
            <a href="mailto:api@uyu.exchange" class="hover:text-brand-700">Contacto</a>
        </div>
        </div>
    </div>
    </footer>

    <!-- Interactividad mínima & hooks a la API -->
    <script>
      // ⚙️ Config pendiente para produccion
      const apikey = "admin123"; // TODO: reemplazar por variable de entorno / inyectar en build
      const API_BASE = "/api";   // si servís desde mismo dominio; o usar https://api.uyu.exchange

      const $ = (sel, el = document) => el.querySelector(sel);
      const $$ = (sel, el = document) => Array.from(el.querySelectorAll(sel));

      // Mobile menu
      const menuBtn = document.getElementById('menuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      menuBtn?.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

      // Render helpers
      function cardTemplate({ name, buy, sell }, badges = {}) {
        const bestBuy = badges.bestBuy ? '<span class="ml-2 inline-flex items-center rounded-full bg-green-100 text-green-800 px-2 py-0.5 text-[11px]">Mejor compra</span>' : '';
        const bestSell = badges.bestSell ? '<span class="ml-2 inline-flex items-center rounded-full bg-indigo-100 text-indigo-800 px-2 py-0.5 text-[11px]">Mejor venta</span>' : '';
        return `
          <div class="rounded-2xl ring-1 ring-slate-200 bg-white p-4">
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold text-slate-700">${name}</div>
              <div class="flex items-center">${bestBuy}${bestSell}</div>
            </div>
            <dl class="mt-3 grid grid-cols-2 gap-2 text-sm">
              <div class="rounded-xl bg-slate-50 p-2">
                <dt class="text-slate-500">Compra</dt>
                <dd class="font-semibold">$ ${Number(buy).toFixed(2)}</dd>
              </div>
              <div class="rounded-xl bg-slate-50 p-2">
                <dt class="text-slate-500">Venta</dt>
                <dd class="font-semibold">$ ${Number(sell).toFixed(2)}</dd>
              </div>
            </dl>
          </div>`;
      }

      function formatUY(n) {
        return new Intl.NumberFormat('es-UY', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);
      }

      function classifyType(name = '') {
        const n = (name || '').toLowerCase();
        const bankKeywords = ['brou','república','republica','itau','itaú','santander','scotiabank','bbva','hsbc','bandes','heritage','credicoop'];
        return bankKeywords.some(k => n.includes(k)) ? 'bank' : 'exchange';
      }

      function splitByType(items) {
        const banks = [], exchanges = [];
        items.forEach(it => (classifyType(it.name) === 'bank' ? banks : exchanges).push(it));
        return { banks, exchanges };
      }

      function computeBest(list) {
        let bestBuy = { idx: -1, val: -Infinity };
        let bestSell = { idx: -1, val: Infinity };
        list.forEach((it, i) => {
          const b = Number(it.buy), s = Number(it.sell);
          if (b > bestBuy.val) bestBuy = { idx: i, val: b };
          if (s < bestSell.val) bestSell = { idx: i, val: s };
        });
        return { bestBuy, bestSell };
      }

      function renderSection(containerId, metaId, list) {
        const grid = document.getElementById(containerId);
        if (!list.length) { grid.innerHTML = '<div class="col-span-full text-sm text-slate-500">Sin datos.</div>'; return { bestBuy: {idx:-1,val:0}, bestSell: {idx:-1,val:0} }; }
        const { bestBuy, bestSell } = computeBest(list);
        const nodes = list.map((item, i) => {
          const el = document.createElement('div');
          el.innerHTML = cardTemplate(item, { bestBuy: i === bestBuy.idx, bestSell: i === bestSell.idx });
          const node = el.firstElementChild;
          node.setAttribute('data-buy', item.buy);
          node.setAttribute('data-sell', item.sell);
          return node;
        });
        grid.replaceChildren(...nodes);
        const meta = document.getElementById(metaId);
        meta.textContent = `Mejor compra: $ ${formatUY(bestBuy.val)} · Mejor venta: $ ${formatUY(bestSell.val)}`;
        return { bestBuy, bestSell };
      }

      // Shimmer básico mientras carga - para revisar
      function showLoading() {
        const skeleton = `
          <div class="rounded-2xl ring-1 ring-slate-200 bg-white p-4 animate-pulse h-28"></div>
        `;
        ['gridBanks','gridExchanges'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.innerHTML = skeleton + skeleton + skeleton + skeleton;
        });
        const select = document.getElementById('sourceSelect');
        if (select) select.innerHTML = '<option disabled selected>Cargando…</option>';
        const last = document.getElementById('lastUpdated');
        if (last) last.textContent = 'Cargando…';
      }

      // Timeout simple (25s)
      function fetchWithTimeout(url, ms = 25000) {
        const ctrl = new AbortController();
        const t = setTimeout(() => { try { ctrl.abort('timeout'); } catch(_){} }, ms);
        return fetch(url, { signal: ctrl.signal, cache: 'no-store' })
          .then(res => { clearTimeout(t); return res; })
          .catch(err => { clearTimeout(t); throw err; });
      }


      // 🔌 Hooks a API (demo con fallback en caso que no carge la API)
        async function loadQuotes() {
          showLoading();
          try {
            const res = await fetchWithTimeout(`${API_BASE}/currency/live?apikey=${apikey}`, 25000);
            if (!res.ok) throw new Error('HTTP ' + res.status);
            const data = await res.json();
            paintQuotes(data);
          } catch (err) {
            const mock = [
              { name: 'Itaú', buy: 51.20, sell: 53.50 },
              { name: 'BROU', buy: 50.90, sell: 53.10 },
              { name: 'Gales', buy: 51.00, sell: 53.30 },
              { name: 'Cambilex', buy: 51.35, sell: 53.40 },
            ];
            paintQuotes(mock);
            const last = document.getElementById('lastUpdated');
            if (last) last.textContent = 'Sin conexión (referencia)';
          }
        }

      function paintQuotes(list) {
        const normalized = (Array.isArray(list) ? list : [])
          .filter(item => item && !Number.isNaN(Number(item.buy)) && !Number.isNaN(Number(item.sell)))
          .map(item => ({
            name: item.name || item.source || 'Fuente',
            buy: Number(item.buy),
            sell: Number(item.sell),
          }));
        const { banks, exchanges } = splitByType(normalized);

        const banksBest = renderSection('gridBanks', 'banksMeta', banks);
        const exchBest = renderSection('gridExchanges', 'exchangesMeta', exchanges);

        // Hero: mostrar mejores de cada tipo (priorizar mejor venta para el público - revisar caso doble)
        const hero = document.getElementById('cardsContainer');
        hero.innerHTML = '';
        const pick = (arr, best) => (best?.idx ?? -1) >= 0 ? arr[best.idx] : null;
        const bestBank = pick(banks, banksBest?.bestSell) || pick(banks, banksBest?.bestBuy);
        const bestExch = pick(exchanges, exchBest?.bestSell) || pick(exchanges, exchBest?.bestBuy);
        const heroNodes = [];
        if (bestBank) {
          const wrap = document.createElement('div');
          wrap.innerHTML = cardTemplate(bestBank, { bestBuy: true, bestSell: true });
          heroNodes.push(wrap.firstElementChild);
        }
        if (bestExch) {
          const wrap = document.createElement('div');
          wrap.innerHTML = cardTemplate(bestExch, { bestBuy: true, bestSell: true });
          heroNodes.push(wrap.firstElementChild);
        }
        if (heroNodes.length) hero.replaceChildren(...heroNodes);


      // Select de calculadora (usar mezcla - revisar)
      const select = document.getElementById('sourceSelect');
      const all = [...banks, ...exchanges];
      select.innerHTML = all.length
        ? all.map((it, i) => `<option value="${i}">${it.name}</option>`).join('')
        : '<option disabled selected>Sin datos</option>';


        document.getElementById('lastUpdated').textContent = new Date().toLocaleString('es-UY');
      }

      // Calculadora
      document.getElementById('calcForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const usd = parseFloat(document.getElementById('usdAmount').value || '0');
        const idx = parseInt(document.getElementById('sourceSelect').value, 10);
        const allCards = [...document.getElementById('gridBanks').children, ...document.getElementById('gridExchanges').children];
        const card = allCards[idx];
        if (!card || Number.isNaN(usd)) return;
        const sell = parseFloat(card.getAttribute('data-sell'));
        const uyus = usd * sell;
        document.getElementById('calcResult').textContent = `${usd.toFixed(2)} USD → $ ${uyus.toFixed(2)} UYU`;
        document.getElementById('calcHint').textContent = `Usando tipo de cambio Venta de la fuente seleccionada.`;
      });

      // Init
      document.getElementById('year').textContent = new Date().getFullYear();
      loadQuotes();
    </script>
  </body>
</html>
